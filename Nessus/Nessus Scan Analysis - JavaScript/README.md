# Nessus Scan Analysis - JavaScript
Javascript code to interact with DOM and collect the reported server details in tab format.

## Usecase  

Script to run on web browser console to check how many hosts (and ports) were reported under particular plugin.

**Note:** This script works for for output types mentioned in the screenshot below. If the nessus plugin contains different formatted output or nessus change it's DOM, you will need to modify the script as per your needs.


## Usage

1. Open the plugin in the Nessus scan results. For example _"Target Credential Status by Authentication Protocol - Valid Credentials Provided"_
2. Open develoepr tools in the web browser (Shortcut: F12) and navigate to console tab
3. Copy and paste the javascript code in web browser console
4. Output shows the details and the reported server, which is tab formatted (easy to copy & paste in excel)

<details>
  <summary>Click to show the sample output</summary>
  
```
Scan Name:	V9 Connectivity Scan (Win+Lin) - PRD+UAT / Plugin #141118
Plugin ID:	141118
Plugin Name:	Target Credential Status by Authentication Protocol - Valid Credentials Provided
Total Hosts :	66
Individual Host count :
		Port Output & Count of hosts [0] : [22 / tcp / ssh] : 24
		Port Output & Count of hosts [1] : [445 / tcp / cifs] : 10
		Port Output & Count of hosts [2] : [445 / tcp / cifs] : 32

1.	141118	22 / tcp / ssh	100.90.1.21
2.	141118	22 / tcp / ssh	100.90.1.133
3.	141118	22 / tcp / ssh	100.90.1.134
4.	141118	22 / tcp / ssh	100.90.2.69
5.	141118	22 / tcp / ssh	100.90.2.70
6.	141118	22 / tcp / ssh	100.90.3.7
7.	141118	22 / tcp / ssh	100.90.4.5
8.	141118	22 / tcp / ssh	100.90.4.6
9.	141118	22 / tcp / ssh	100.90.4.197
10.	141118	22 / tcp / ssh	100.90.4.198
11.	141118	22 / tcp / ssh	100.90.5.136
12.	141118	22 / tcp / ssh	100.90.5.138
13.	141118	22 / tcp / ssh	100.90.5.147
14.	141118	22 / tcp / ssh	100.90.5.148
15.	141118	22 / tcp / ssh	100.90.5.149
16.	141118	22 / tcp / ssh	100.90.10.134
17.	141118	22 / tcp / ssh	100.90.10.135
18.	141118	22 / tcp / ssh	100.90.20.70
19.	141118	22 / tcp / ssh	100.90.20.71
20.	141118	22 / tcp / ssh	100.90.30.6
21.	141118	22 / tcp / ssh	100.90.30.7
22.	141118	22 / tcp / ssh	100.90.30.198
23.	141118	22 / tcp / ssh	100.90.30.199
24.	141118	22 / tcp / ssh	100.90.40.8
25.	141118	445 / tcp / cifs	100.90.1.197
26.	141118	445 / tcp / cifs	100.90.1.198
27.	141118	445 / tcp / cifs	100.90.1.199
28.	141118	445 / tcp / cifs	100.90.2.5
29.	141118	445 / tcp / cifs	100.90.2.6
30.	141118	445 / tcp / cifs	100.90.2.133
31.	141118	445 / tcp / cifs	100.90.2.134
32.	141118	445 / tcp / cifs	100.90.3.5
33.	141118	445 / tcp / cifs	100.90.4.68
34.	141118	445 / tcp / cifs	100.90.4.69
35.	141118	445 / tcp / cifs	100.90.1.12
36.	141118	445 / tcp / cifs	100.90.1.17
37.	141118	445 / tcp / cifs	100.90.1.18
38.	141118	445 / tcp / cifs	100.90.1.20
39.	141118	445 / tcp / cifs	100.90.1.22
40.	141118	445 / tcp / cifs	100.90.1.24
41.	141118	445 / tcp / cifs	100.90.1.30
42.	141118	445 / tcp / cifs	100.90.5.134
43.	141118	445 / tcp / cifs	100.90.5.135
44.	141118	445 / tcp / cifs	100.90.5.137
45.	141118	445 / tcp / cifs	100.90.5.141
46.	141118	445 / tcp / cifs	100.90.5.142
47.	141118	445 / tcp / cifs	100.90.5.146
48.	141118	445 / tcp / cifs	100.90.10.198
49.	141118	445 / tcp / cifs	100.90.10.199
50.	141118	445 / tcp / cifs	100.90.10.200
51.	141118	445 / tcp / cifs	100.90.20.6
52.	141118	445 / tcp / cifs	100.90.20.7
53.	141118	445 / tcp / cifs	100.90.20.134
54.	141118	445 / tcp / cifs	100.90.20.135
55.	141118	445 / tcp / cifs	100.90.30.70
56.	141118	445 / tcp / cifs	100.90.30.71
57.	141118	445 / tcp / cifs	100.90.40.6
58.	141118	445 / tcp / cifs	100.90.40.7
59.	141118	445 / tcp / cifs	100.90.50.6
60.	141118	445 / tcp / cifs	100.90.50.9
61.	141118	445 / tcp / cifs	100.90.50.10
62.	141118	445 / tcp / cifs	100.90.50.11
63.	141118	445 / tcp / cifs	100.90.50.134
64.	141118	445 / tcp / cifs	100.90.50.137
65.	141118	445 / tcp / cifs	100.90.50.138
66.	141118	445 / tcp / cifs	100.90.50.139
```
</details>

## Java Script

```JavaScript 
//Scan name, plugin details
const scan_name = document.querySelector("#titlebar > h1").innerHTML;
const scan_name2 = scan_name.split('\n'); //scan_name2[0]
const plugin_id = document.querySelector("#content > section > div.right-column > div:nth-child(2) > span:nth-child(5)").innerText; 
const plugin_name = document.querySelector("#content > section > div.main-column > div.plugin-details-header > h4").innerHTML; 

//get the list of output sections
const op_count = document.querySelector("#content > section > div.main-column > div:nth-child(3) > ul").querySelectorAll('li'); 
const outputs=[];
const port=[];

//get the list of hosts in the output sections
for (let i = 0; i < op_count.length; i++) {
//console.log("Now checking: " + i)
outputs[i] = document.getElementsByClassName("plugin-output-wrapper")[i].querySelectorAll("a");
port[i] = document.getElementsByClassName("plugin-output-wrapper")[i].querySelectorAll('td > span')[0].innerHTML;
}

//Convert obj to array
const arr2 = Object.entries(outputs);
arr2[0][1].length

//Count total hosts and the individual count
hosts_port_count = 0
hosts_port_out = ""

for (let i = 0; i < op_count.length; i++) {
	hosts_port_out += "\t\tPort Output & Count of hosts [" +i+"] : [" + port[i] + "] : " + arr2[i][1].length + "\n"
	hosts_port_count += arr2[i][1].length
}

//Print the output in formatted form
console.log("Scan Name:\t" + scan_name2[0] + "\nPlugin ID:\t" + plugin_id + "\nPlugin Name:\t" + plugin_name +  "\nTotal Hosts :\t" + hosts_port_count + "\nIndividual Host count :\n" + hosts_port_out + "\n\n")

sno_counter=0
for (let i = 0; i < op_count.length; i++) {
	for (let j = 0; j < arr2[i][1].length; j++) {
		sno_counter += 1
		console.log(sno_counter + ".\t" + plugin_id +"\t"+ port[i] +"\t"+ arr2[i][1][j].innerHTML)
	//outputs[i] = document.getElementsByClassName("plugin-output-wrapper")[i].querySelectorAll("a");
	}
}
```



## Screenshots:
1.Showing where to paste the above JS code and what is the expected output
<kbd>![](images/Image-1.png)</kbd>

2.Showing the output tables and their count of identified servers
<kbd>![](images/Image-2.png)</kbd>

3.Showing the output copied to Excel for further analysis/preparing reports
<kbd>![](images/Image-3.png)</kbd>

