metadata:
    language: v2-beta
    name: "V9Y - Referer | Referer specific response observed"
    description: "Test for Referer header"
    author: "Vinaya Kumar"

run for each:
    potential_path = `v9y1dmn{random_str(8)}.com.sg`, `v9y2subdmn{random_str(5)}.{regex_replace({base.request.url.host}, "www\.", "")}`

given request then
    send request:
        headers:
            "Referer": {potential_path}

    if not({latest.response.body} differs from {base.response.body}) and "" in {base.response} then # and {latest.response.status_code} is {base.response.status_code} then
      report issue:
        severity: info
        confidence: firm
        detail: `Server might be responding differently for the request with different REFERER header
                
                LATEST STATUS CODE = {latest.response.status_code}
                BASE STATUS CODE = {base.response.status_code} 
                HTTP_METHOD = {base.request.method}
                RESPONSE contains:\t{potential_path}
                REFERER used:\t\t\t{potential_path}`
    end if
